<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>
Chaojie&#x27;s Home ✍️ | How to Run Hatch Within Github Workflow
</title>
    <meta name="description" content="The place where Chaojie writes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content=" Chaojie&#x27;s Home ✍️  | How to Run Hatch Within Github Workflow">
    <meta property="og:description" content="The place where Chaojie writes">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chaojie.fun/articles/how-to-run-hatch-within-github-action/">

    
    <link rel="alternate" type="application/atom+xml" title="RSS"
        href="https://chaojie.fun/atom.xml">
    
    <link rel="icon" href="https://chaojie.fun/images/favicon.ico" sizes="any">
    <link rel="stylesheet" href="https://chaojie.fun/libs/tabler.min.css">
    <link rel="stylesheet" href="https://chaojie.fun/css/uno.css">
    <link rel="stylesheet" href="https://chaojie.fun/assets/willow.css">

    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XDREGKCZH0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-XDREGKCZH0');
    </script>
    
</head>

<body>
    <div class="theme-light text-base font-sans" id="theme">
        <div class="container-xl subpixel-antialiased">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-xl-9">
                    
<div class="col" style="margin: 24px 0;">
    <div class="row align-items-end">
        <div class="col-auto" style="margin: auto 0;">
            <a href="https://chaojie.fun/">
                <img src="https://chaojie.fun/images/logo.png" width="40" height="46" class="">
            </a>
        </div>
        <div class="col">
            <div class="row">
                <div class="col">
                    <h2 class="mb-0 tracking-wide">Chaojie&#x27;s Home ✍️</h2>
                </div>
            </div>
            <div class="row">
                <nav>
                    
<ul class="list-inline list-inline-dots mb-0">
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/">
            Home
        </a>
    </li>
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/articles/">
            Articles
        </a>
    </li>
    
    
    
    
    
    
    
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/memos/">
            Memos
        </a>
    </li>
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/tags/">
            Tags
        </a>
    </li>
    
    
    
    
    
    
    
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/about/">
            About
        </a>
    </li>
    
    
    
</ul>

                </nav>
            </div>
        </div>
        <div class="col align-self-end">
            <div class="d-flex justify-content-end space-x">
                
                
                <a href="https://chaojie.fun/atom.xml" target="_blank">
                    
                    <img src="https://chaojie.fun/images/social/douban.svg" alt=douban width="18" height="18">
                </a>
                
                <a href="https://chaojie.fun/atom.xml" target="_blank">
                    
                    <img src="https://chaojie.fun/images/social/github.svg" alt=github width="18" height="18">
                </a>
                
                <a href="https://chaojie.fun/atom.xml" target="_blank">
                    
                    <img src="https://chaojie.fun/images/social/twitter.svg" alt=twitter width="18" height="18">
                </a>
                
                
                <a href="https://chaojie.fun/atom.xml" target="_blank">
                    <img src="https://chaojie.fun/images/social/rss.svg" alt="RSS" width="18" height="18">
                </a>
            </div>
        </div>
    </div>
</div>

                    

<div class="card card-lg">
    <div class="card-body markdown text-justify">
        <div class="">
            
            
            <div class="d-flex justify-content-between" style="margin-bottom: 18px;">
                <div>2023-01-28</div>
                
                <i class="fas fa-tags"></i>
                <ul class="list-inline list-inline-dots mb-0">
                    
                    <li class="list-inline-item">
                        <a class="tag"
                            href="https://chaojie.fun/tags/hatch/">#Hatch</a>
                    </li>
                    
                    <li class="list-inline-item">
                        <a class="tag"
                            href="https://chaojie.fun/tags/python/">#Python</a>
                    </li>
                    

                </ul>
                
            </div>
            

            <h1>How to Run Hatch Within Github Workflow</h1>
            <p><p>Hatch support support define matrix within a environment (<a href="https://hatch.pypa.io/latest/config/environment/advanced/#matrix">matrix docs</a>), this is so useful when you want to run test against different python version. For example:</p>
<pre data-lang="toml" style="background-color:#2b303b;color:#c0c5ce;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[tool.hatch.envs.test]
</span><span style="color:#bf616a;">dependencies </span><span>= [
</span><span>  &quot;</span><span style="color:#a3be8c;">pytest</span><span>&quot;,
</span><span>]
</span><span>
</span><span>[[tool.hatch.envs.test.matrix]]
</span><span style="color:#bf616a;">python </span><span>= [&quot;</span><span style="color:#a3be8c;">3.7</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.8</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.9</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.10</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.11</span><span>&quot;]
</span><span>
</span><span>[tool.hatch.envs.test.scripts]
</span><span style="color:#bf616a;">test </span><span>= &quot;</span><span style="color:#a3be8c;">pytest tests/</span><span>&quot;
</span></code></pre>
<p>But how to run hatch within github workflow? This post will show you how to do it.</p>
<p>In github workflow you can also define matrix to run job against different python version,
maybe you want set CI like this:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">name</span><span>: &quot;</span><span style="color:#a3be8c;">CI</span><span>&quot;
</span><span>
</span><span style="color:#d08770;">on</span><span>:
</span><span>  </span><span style="color:#bf616a;">push</span><span>:
</span><span>    </span><span style="color:#bf616a;">branches</span><span>: [</span><span style="color:#a3be8c;">main</span><span>]
</span><span>  </span><span style="color:#bf616a;">pull_request</span><span>:
</span><span>    </span><span style="color:#bf616a;">branches</span><span>: [</span><span style="color:#a3be8c;">main</span><span>]
</span><span>
</span><span style="color:#bf616a;">jobs</span><span>:
</span><span>  </span><span style="color:#bf616a;">run</span><span>:
</span><span>    </span><span style="color:#bf616a;">name</span><span>: &quot;</span><span style="color:#a3be8c;">tests &amp; coverage</span><span>&quot;
</span><span>    </span><span style="color:#bf616a;">runs-on</span><span>: </span><span style="color:#a3be8c;">ubuntu-latest
</span><span>    </span><span style="color:#bf616a;">strategy</span><span>:
</span><span>      </span><span style="color:#bf616a;">matrix</span><span>:
</span><span>        </span><span style="color:#bf616a;">python-version</span><span>: [&quot;</span><span style="color:#a3be8c;">3.7</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.8</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.9</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.10</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.11</span><span>&quot;]
</span><span>
</span><span>    </span><span style="color:#bf616a;">steps</span><span>:
</span><span>      - </span><span style="color:#bf616a;">uses</span><span>: </span><span style="color:#a3be8c;">actions/checkout@v3
</span><span>      - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Set up Python ${{ matrix.python-version }}
</span><span>        </span><span style="color:#bf616a;">uses</span><span>: </span><span style="color:#a3be8c;">actions/setup-python@v4
</span><span>        </span><span style="color:#bf616a;">with</span><span>:
</span><span>          </span><span style="color:#bf616a;">python-version</span><span>: </span><span style="color:#a3be8c;">${{ matrix.python-version }}
</span><span>
</span><span>      - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Install hatch
</span><span>        </span><span style="color:#bf616a;">run</span><span>: </span><span style="color:#a3be8c;">python -m pip install hatch
</span><span>
</span><span>      </span><span style="color:#65737e;"># then run test
</span></code></pre>
<p>If you directly run <code>hatch run test:test</code>, Hatch will try to set virtualenv for each python version.It will failed, because only one system python is installed at each strategy.</p>
<p>Fortunately, hatch can use <code>+py</code> to specify the python version to run env command, so you can change the CI config like this:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span>- </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Tests
</span><span>  </span><span style="color:#bf616a;">run</span><span>: </span><span style="color:#a3be8c;">hatch run +py=${{ matrix.python-version }}  test:test
</span></code></pre>
<p>The full CI config:</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#bf616a;">name</span><span>: &quot;</span><span style="color:#a3be8c;">CI</span><span>&quot;
</span><span>
</span><span style="color:#d08770;">on</span><span>:
</span><span>  </span><span style="color:#bf616a;">push</span><span>:
</span><span>    </span><span style="color:#bf616a;">branches</span><span>: [ </span><span style="color:#a3be8c;">main </span><span>]
</span><span>  </span><span style="color:#bf616a;">pull_request</span><span>:
</span><span>    </span><span style="color:#bf616a;">branches</span><span>: [ </span><span style="color:#a3be8c;">main </span><span>]
</span><span>
</span><span style="color:#bf616a;">jobs</span><span>:
</span><span>  </span><span style="color:#bf616a;">run</span><span>:
</span><span>    </span><span style="color:#bf616a;">name</span><span>: &quot;</span><span style="color:#a3be8c;">tests &amp; coverage</span><span>&quot;
</span><span>    </span><span style="color:#bf616a;">runs-on</span><span>: </span><span style="color:#a3be8c;">ubuntu-latest
</span><span>    </span><span style="color:#bf616a;">strategy</span><span>:
</span><span>      </span><span style="color:#bf616a;">matrix</span><span>:
</span><span>        </span><span style="color:#bf616a;">python-version</span><span>: [&quot;</span><span style="color:#a3be8c;">3.7</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.8</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.9</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.10</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">3.11</span><span>&quot;]
</span><span>
</span><span>    </span><span style="color:#bf616a;">steps</span><span>:
</span><span>    - </span><span style="color:#bf616a;">uses</span><span>: </span><span style="color:#a3be8c;">actions/checkout@v3
</span><span>    - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Set up Python ${{ matrix.python-version }}
</span><span>      </span><span style="color:#bf616a;">uses</span><span>: </span><span style="color:#a3be8c;">actions/setup-python@v4
</span><span>      </span><span style="color:#bf616a;">with</span><span>:
</span><span>        </span><span style="color:#bf616a;">python-version</span><span>: </span><span style="color:#a3be8c;">${{ matrix.python-version }}
</span><span>
</span><span>    - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Install hatch
</span><span>      </span><span style="color:#bf616a;">run</span><span>: </span><span style="color:#a3be8c;">python -m pip install hatch
</span><span>
</span><span>    - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Lint
</span><span>      </span><span style="color:#bf616a;">run</span><span>: </span><span style="color:#a3be8c;">hatch run check
</span><span>
</span><span>    - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Coverage
</span><span>      </span><span style="color:#bf616a;">run</span><span>: </span><span style="color:#a3be8c;">hatch run +py=${{ matrix.python-version }} test:test
</span><span>
</span><span>    - </span><span style="color:#bf616a;">name</span><span>: </span><span style="color:#a3be8c;">Upload Coverage
</span><span>      </span><span style="color:#bf616a;">uses</span><span>: </span><span style="color:#a3be8c;">codecov/codecov-action@v3
</span><span>      </span><span style="color:#bf616a;">with</span><span>:
</span><span>        </span><span style="color:#bf616a;">files</span><span>: </span><span style="color:#a3be8c;">coverage.xml
</span></code></pre>
<p>Hope this post can help you.</p>
</p>

            
            
            <script src="https://giscus.app/client.js" data-repo="ischaojie/blog"
                data-repo-id="MDEwOlJlcG9zaXRvcnkyODk4MDA1NTY="
                data-category="[object]"
                data-category-id="[object]"
                data-mapping="[object]" data-strict="0" data-reactions-enabled="1"
                data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme"
                data-lang="en" data-loading="lazy" crossorigin="anonymous" async>
                </script>
            
            
        </div>
    </div>
</div>


                    
<footer class="footer footer-transparent d-print-none">
    <div class="container-xl">
        <div class="row text-center align-items-center flex-row-reverse">
            <div class="col-lg-auto ms-lg-auto">
                
<ul class="list-inline list-inline-dots mb-0">
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/">
            Home
        </a>
    </li>
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/articles/">
            Articles
        </a>
    </li>
    
    
    
    
    
    
    
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/memos/">
            Memos
        </a>
    </li>
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/tags/">
            Tags
        </a>
    </li>
    
    
    
    
    
    
    
    
    
    
    <li class="list-inline-item">
        <a class="link-secondary" href="https://chaojie.fun/about/">
            About
        </a>
    </li>
    
    
    
</ul>

            </div>
            <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                    <li class="list-inline-item">
                        Copyright © 2023
                        <a href="." class="link-secondary">Chaojie</a>.
                        All rights reserved.
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

                </div>
            </div>
        </div>
    </div>
    <script src="https://chaojie.fun/libs/tabler.min.js"></script>
    <script src="https://chaojie.fun/libs/fslightbox.js"></script>
    <script src="https://chaojie.fun/libs/infinite-scroll.min.js"></script>
    <script src="https://chaojie.fun/libs/luxon.min.js"></script>
    <script src="https://chaojie.fun/js/willow.js"></script>
    


</body>

</html>
